# docker-compose.yml for the GeoAI application
# This configuration requires NVIDIA Container Toolkit to be installed on the host.
# Usage:
# 1. Create a .env file with your HUGGINGFACE_API_KEY
# 2. Run: docker-compose up --build

version: '3.8'

services:
  geoai-app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: geoai_app
    ports:
      - "8501:8501"
    # Load environment variables from a .env file in the same directory
    env_file:
      - .env
    volumes:
      # Mount a named volume to persist Hugging Face models and datasets
      # This prevents re-downloading large models on every container restart
      - hf_cache:/root/.cache/huggingface
      # Mount a named volume to persist application logs
      - app_logs:/app/logs
    # GPU Configuration: This section allocates GPU resources to the container.
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1 # Request 1 GPU
              capabilities: [gpu]

volumes:
  # Define the named volumes for persistence
  hf_cache:
    driver: local
  app_logs:
    driver: local
